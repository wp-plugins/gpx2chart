var Canvas2Image=(function(){var k=false;var h=document.createElement("canvas");if(h.getContext("2d")){k=true}if(!k){return{saveAsBMP:function(){},saveAsPNG:function(){},saveAsJPEG:function(){}}}var c=!!(h.getContext("2d").getImageData);var d=!!(h.toDataURL);var a=!!(window.btoa);var e="image/octet-stream";var m=function(n){var o=parseInt(n.width);var p=parseInt(n.height);return n.getContext("2d").getImageData(0,0,o,p)};var f=function(p){var q="";if(typeof p=="string"){q=p}else{var n=p;for(var o=0;o<n.length;o++){q+=String.fromCharCode(n[o])}}return btoa(q)};var j=function(B){var s=[];var E=B.width;var p=B.height;s.push(66);s.push(77);var z=E*p*3+54;s.push(z%256);z=Math.floor(z/256);s.push(z%256);z=Math.floor(z/256);s.push(z%256);z=Math.floor(z/256);s.push(z%256);s.push(0);s.push(0);s.push(0);s.push(0);s.push(54);s.push(0);s.push(0);s.push(0);var u=[];u.push(40);u.push(0);u.push(0);u.push(0);var w=E;u.push(w%256);w=Math.floor(w/256);u.push(w%256);w=Math.floor(w/256);u.push(w%256);w=Math.floor(w/256);u.push(w%256);var n=p;u.push(n%256);n=Math.floor(n/256);u.push(n%256);n=Math.floor(n/256);u.push(n%256);n=Math.floor(n/256);u.push(n%256);u.push(1);u.push(0);u.push(24);u.push(0);u.push(0);u.push(0);u.push(0);u.push(0);var o=E*p*3;u.push(o%256);o=Math.floor(o/256);u.push(o%256);o=Math.floor(o/256);u.push(o%256);o=Math.floor(o/256);u.push(o%256);for(var D=0;D<16;D++){u.push(0)}var A=(4-((E*3)%4))%4;var H=B.data;var q="";var r=p;do{var F=E*(r-1)*4;var C="";for(var t=0;t<E;t++){var G=4*t;C+=String.fromCharCode(H[F+G+2]);C+=String.fromCharCode(H[F+G+1]);C+=String.fromCharCode(H[F+G])}for(var I=0;I<A;I++){C+=String.fromCharCode(0)}q+=C}while(--r);var v=f(s.concat(u))+f(q);return v};var b=function(n){document.location.href=n};var i=function(o,n){return"data:"+n+";base64,"+o};var l=function(n){var o=document.createElement("img");o.src=n;return o};var g=function(o,p,r){if(p&&r){var q=document.createElement("canvas");q.width=p;q.height=r;q.style.width=p+"px";q.style.height=r+"px";var n=q.getContext("2d");n.drawImage(o,0,0,o.width,o.height,0,0,p,r);return q}return o};return{saveAsPNG:function(o,n,p,s){if(!d){return false}var q=g(o,p,s);var r=q.toDataURL("image/png");if(n){return l(r)}else{b(r.replace("image/png",e))}return true},saveAsJPEG:function(o,n,p,t){if(!d){return false}var q=g(o,p,t);var s="image/jpeg";var r=q.toDataURL(s);if(r.indexOf(s)!=5){return false}if(n){return l(r)}else{b(r.replace(s,e))}return true},saveAsBMP:function(p,o,q,s){if(!(c&&a)){return false}var r=g(p,q,s);var t=m(r);var n=j(t);if(o){return l(i(n,"image/bmp"))}else{b(i(n,e))}return true}}})();